<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/av-icons.html">

<dom-module id="show-banquets-admin"> 
    <template>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
        <style>
            :host {
                display: block;
            }
            /* .tabtitle {
                transition: box-shadow .3s ease;
                background: #E8EAF6;
            } */
            .row {
                padding: 1em;
            }
            paper-checkbox {
                padding: 1em;
            }
            paper-fab {
                --paper-fab-background: var(--paper-indigo-500);
                --paper-fab-keyboard-focus-background: var(--paper-indigo-900);
                position: fixed;
                bottom: 4.5em;
                right: 1.5em; 
            }
            google-chart {
                background-color: grey;
                width: 100%;/*debug*/
                min-height: 450px;
                display: block;
            } 
            .statPart {
                display: none;
            }
        </style>
        <p>More operations of specific banquet can be found in banquet detailed page</p>
        <div class="tabtitle" class="container">
            <div class="row align-items-center">
                <paper-dropdown-menu label="Select information shown in the table" class="col-5">
                    <div class="dropdown-content checkbox-group" slot="dropdown-content">
                        <template is="dom-repeat" items={{_assignments_list}} as="assign_name">
                            <paper-checkbox on-change="checkboxChanged" id="{{assign_name}}" checked>{{assign_name}}</paper-checkbox>
                        </template>
                    </div>
                </paper-dropdown-menu>
                <paper-input class="col" label="Search banquet by name" on-input="changeSearch" id="searchinput" value="{{searchQuery}}">
                    <iron-icon icon="search" slot="suffix"></iron-icon>
                </paper-input>
                <paper-toggle-button checked="{{showStat}}" class="col-2" checked>Operations</paper-toggle-button>
            </div>
        </div>

        <table class='table table-hover mt-3'>
            <thead>
                <tr>
                    <th>Banquet Name
                        <paper-icon-button id="usernameSortBtn"icon="av:sort-by-alpha" style="color: grey;" on-click="sort"></paper-icon-button>
                        <paper-tooltip for="usernameSortBtn" offset="10" position="bottom">Sort the table: A-Z of username</paper-tooltip>
                    </th>
                    <template is="dom-repeat" items={{_banquets_array_sample.info}} as="banquetinfo">
                        <td>{{banquetinfo.key}}
                            <paper-icon-button id="{{banquetinfo.key}}SortBtn" icon="icons:sort" style="color: grey;" on-click="sort"></paper-icon-button>
                            <paper-tooltip for="{{banquetinfo.key}}SortBtn" offset="10" position="bottom">Sort the table: high to low of {{banquetinfo.key}}</paper-tooltip>
                        </td>
                    </template>
                    <!-- <td hidden$="[[!showStat]]">Median
                        <paper-icon-button id="medianSortBtn" icon="icons:sort" style="color: grey;" on-click="sort"></paper-icon-button>
                        <paper-tooltip for="medianSortBtn" offset="10" position="bottom">Sort the table: high to low of class median</paper-tooltip>
                    </td>
                    <td hidden$="[[!showStat]]">Average
                        <paper-icon-button id="averageSortBtn" icon="icons:sort" style="color: grey;" on-click="sort"></paper-icon-button>
                        <paper-tooltip for="averageSortBtn" offset="10" position="bottom">Sort the table: high to low of class average</paper-tooltip>
                    </td> -->
                    <td hidden$="[[!showStat]]">Operations
                        <paper-icon-button id="totalSortBtn" icon="icons:sort" style="color: grey;" on-click="sort"></paper-icon-button>
                        <paper-tooltip for="totalSortBtn" offset="10" position="bottom">Sort the table: high to low of class total scores</paper-tooltip>
                    </td>
                </tr>
            </thead>
            <tbody>
                <template is="dom-repeat" items={{_banquets_array}} as="banquet">
                    <tr>
                        <th scope='row'>
                            <paper-icon-button id="{{stu.name}}"icon="icons:more-horiz" style="color: grey;"></paper-icon-button>
                            <paper-tooltip for="{{stu.name}}" offset="5" position="left">Detail statistics for {{stu.userID}}</paper-tooltip>
                            {{banquet.name}}
                        </th>
                        <template is="dom-repeat" items={{banquet.info}} as="info">
                            <td>{{info.value}}</td>
                            <!-- <td>[[_getScore(stu, assign_name)]]</td> -->
                        </template>
                        <template is="dom-repeat" items={{stu.stats}} as="stats">
                            <td hidden$="[[!showStat]]">{{stats}}</td>
                            <!-- <td>[[_getScore(stu, assign_name)]]</td> -->
                        </template>
                    </tr>
                </template>
            </tbody>
        </table>
        <a on-click="download"><paper-fab mini icon="icons:file-download" id="fab-export"></paper-fab></a>
        <paper-tooltip for="fab-export" offset="10" position="left">Export the table to csv file and download</paper-tooltip>
    </template>

    <script>
        /**
         * `dash-stu-grades-page`
         * the page on the dashboard to show all grades information
         *
         * @customElement
         * @polymer
         */
        class ShowBanquetsAdmin extends Polymer.Element {
            static get is() { return 'show-banquets-admin'; }
            static get properties() {
                return {
                    banquets: {
                        type: Object,
                        notify: true,
                        observer: "_observer1"
                    },
                    _banquets_array: {
                        type: Array
                    },
                    showStat: {
                        type: Number,
                        value: 1
                    }
                };
            }

            // OBSERVER
            _observer1(value){
                console.log("inside", value);
                var outputarray = [];
                for (var key in value){
                    var innerjson = value[key];
                    innerjson['key'] = key;
                    var newjsontemp = [];
                    for (var key1 in innerjson){
                        if (key1 != 'name'){
                            var tempJson = {
                                'key': key1,
                                'value': innerjson[key1]
                            }
                            newjsontemp.push(tempJson);
                        }
                    }
                    innerjson['info'] = newjsontemp
                    outputarray.push(innerjson);
                }
                console.log(outputarray);
                this.set('_banquets_array', outputarray);
                this.set('_banquets_array_sample', outputarray[0]);
            }
        }
        window.customElements.define(ShowBanquetsAdmin.is, ShowBanquetsAdmin);
    </script>
</dom-module>